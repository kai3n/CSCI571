<html>
<head>
	<meta charset="UTF-8">
	<title>CSCI 571 HW4</title>
	<script>
		function generateHTML(xmlDoc){

		    try{
                ELEMENT_NODE = 1; WIDTH = 150; HEIGHT = 75;

                root = xmlDoc.DocumentElement;
                htmlText = "<html><head></head><body>";
                htmlText += "<table border='2'>";
                airlines = xmlDoc.getElementsByTagName("Row");
                column = xmlDoc.getElementsByTagName("Data");
                airlineList = airlines.item(0).childNodes;
			    columnList = column.item(0).childNodes;
                htmlText += "<tr>";

                // to generate column names
                for(i = 0; i < column.length; i++){
                    columnName = column.item(i).textContent;
                    htmlText += "<th>" + columnName + "</th>";
                }
                htmlText += "</tr>";

				// to generate tuples
                for(i = 0; i < airlines.length; i++){
                    airlineList = airlines.item(i).childNodes;

                    htmlText += "<tr>";
                    for(j = 0; j < airlineList.length; j++){
                        if(airlineList.item(j).nodeType == ELEMENT_NODE){
                            if(airlineList.item(j).nodeName == "HomePage"){
                                link = airlineList.item(j).textContent;
                                htmlText += "<td><a href='" + link + "'>" + link + "</a></td>";
                            }
                            else if(airlineList.item(j).nodeName == "Plane"){
                                htmlText += "<td><img src='" + airlineList.item(j).textContent + "' width='" + WIDTH + "' height='" + HEIGHT + "'></td>";
                            }
                            else if(airlineList.item(j).nodeName == "Hubs") {
                                htmlText += "<td>"
                                for (k = 0; k < airlineList.item(j).childNodes.length; k++) {
                                    if (airlineList.item(j).childNodes[k].nodeType == ELEMENT_NODE) {
                                        htmlText += "<li>"+airlineList.item(j).childNodes[k].textContent+"</li>";
                                    }
                                }
                                htmlText += "</td>"
                            }
                            else {
                                if(airlineList.item(j).textContent){
                                    htmlText += "<td>" + airlineList.item(j).textContent + "</td>";
                                }
                                else{
                                    htmlText += "<td></td>";
                                }

                            }
                        }
                    }
                    htmlText += "</tr>";
                }
                    htmlText += "</table>";
                    htmlText += "</body></html>";

            } catch(ex){
		        alert('Error in XML file');
            }
		}

		function loadXML(url) {
            if (window.XMLHttpRequest){
                // code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp = new XMLHttpRequest();
            }
            else {
                // code for IE6, IE5
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            // check exist file name
            try{
                xmlhttp.open("GET", url, false);
                xmlhttp.send();
                xmlDoc = xmlhttp.responseXML;
                return xmlDoc;
            } catch(ex){
                return 0
            }
        }

		function viewXML(what){
			var URL = what.URL.value;
			xmlDoc = loadXML(URL);
			if (xmlDoc != 0){
			    if (window.ActiveXObject){
                    //if IE, simply execute script (due to async prop).
                    if (xmlDoc.parseError.errorCode != 0){
                        generateError(xmlDoc);
                        hWin = window.open("", "Error", "height=600,width=800,scrollbars=yes");
                        hWin.document.write(htmlText);
                    }
                    else {
                        generateHTML(xmlDoc);
                        hWin = window.open("", "Assignment4", "height=800,width=600,scrollbars=yes");
                        hWin.document.write(htmlText);
                    }
                }
                else {
                    //else if FF, execute script once XML object has loaded
                    xmlDoc.onload=generateHTML(xmlDoc);
                    hWin = window.open("", "Assignment4", "height=600,width=800,scrollbars=yes");
                    hWin.document.write(htmlText);
                }
                hWin.document.close();
            }
            else {
			    alert('The file doesn\'t exist!');
            }
		}
	</script>
</head>
<style type="text/css">
    .center{
        text-align: center;
    }
    .submit{
        color: #000;
        background-color: #999;
        border-color: #888;
    }
    .submit:active{
        color: #fff;
        background-color: #999;
        border-color: #888;
    }
</style>
<body>
	<div class="center">
		<br><b>Enter URL for Company List XML File</b><br><br>
		<form name="myForm">
			<input type="text" name="URL">
			<br><br>
			<input type="button" class="submit" name="submit" value="Submit Query" onClick="viewXML(this.form)">
		</form>
	</div>
</body>
</html>